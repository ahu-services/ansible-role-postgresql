---
- name: Install PostgreSQL Repositories
  ansible.builtin.dnf:
    name: "{{ postgresql_pgdg_repo_url }}"
    disable_gpg_check: true
  become: true

- name: Import PGDG repository GPG keys
  ansible.builtin.rpm_key:
    key: "{{ item }}"
    state: present
  loop: "{{ postgresql_pgdg_gpg_keys }}"
  become: true

- name: Disable postgresql module
  ansible.builtin.command: dnf module disable -y postgresql
  become: true
  register: result
  changed_when:
    - '"Disabling module streams" in result.stdout'

- name: Show debug pacakges
  ansible.builtin.debug:
    var: postgresql_packages

- name: Install PostgreSQL Server
  ansible.builtin.dnf:
    name: "{{ postgresql_packages }}"
  become: true
